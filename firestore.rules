rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Only allow the user with the specific UID (which corresponds to the allowed email)
    // Since we don't know the UID ahead of time, we rely on the client-side check + 
    // ensuring the authenticated user is reading/writing their OWN data.
    // Ideally we would hardcode the UID here, but email is dynamic.
    // Best practice for "single user app" without hardcoding UID in rules:
    
    // 1. Users can only read/write their own user document
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 2. Workouts can only be read/written if the document has the user's UID field
    match /workouts/{workoutId} {
        allow read: if request.auth != null && resource.data.uid == request.auth.uid;
        allow create: if request.auth != null && request.resource.data.uid == request.auth.uid;
        allow update, delete: if request.auth != null && resource.data.uid == request.auth.uid;
    }

    match /exercises/{exerciseId} {
       // Allow read for authenticated users (the single user)
       allow read: if request.auth != null;
       // Only allow write if admin (or just lock it down after seeding)
       allow write: if request.auth != null; 
    }
    
    // Any other collection
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
